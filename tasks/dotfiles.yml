- name: Setup dotfiles
  block: 
  - name: Clone dotfiles repo
    ansible.builtin.git:
      repo: https://gitlab.com/nikola.stojkovic/dotfiles_new
      dest: $HOME/.dotfiles
      bare: true
    become: true
    become_user: "{{ user }}"

  - name: Git checkout
    command: /usr/bin/git --git-dir=$HOME/.dotfiles/ --work-tree=$HOME checkout
    become: true
    become_user: "{{ user }}"

  - name: Insert/Update .zshrc with dotnet related stuff
    ansible.builtin.blockinfile:
      path: "/home/{{ user }}/.zshrc"
      marker: "# {mark} ANSIBLE MANAGED BLOCK - DOTFILES"
      insertafter: "# ANSIBLE MANAGED STUFF"
      block: |
        alias config='/usr/bin/git --git-dir=/home/{{ user }}/.dotfiles/ --work-tree=/home/{{ user }}'
